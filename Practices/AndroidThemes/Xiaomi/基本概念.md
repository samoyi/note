<!-- vscode-markdown-toc -->
* 1. [TODO](#TODO)
* 2. [概述](#)
	* 2.1. [TODO](#TODO-1)
* 3. [机型适配](#-1)
	* 3.1. [TODO](#TODO-1)
* 4. [数据类型](#-1)
* 5. [变量/全局变量/表达式/内置函数](#-1)
	* 5.1. [`<Var>` 和 `<VariableCommand>` 的区别](#VarVariableCommand)
		* 5.1.1. [单一变量（非数组）的情况](#-1)
		* 5.1.2. [数组的情况](#-1)
* 6. [添加解锁](#-1)
	* 6.1. [TODO](#TODO-1)
* 7. [文本](#-1)
* 8. [日期](#-1)
* 9. [组](#-1)
	* 9.1. [TODO](#TODO-1)
* 10. [图片](#-1)
	* 10.1. [旋转](#-1)
	* 10.2. [align/alignV](#alignalignV)
	* 10.3. [色调（染色）](#-1)
	* 10.4. [TODO](#TODO-1)
* 11. [笔刷](#-1)
	* 11.1. [TODO](#TODO-1)
* 12. [图片变形](#-1)
* 13. [几何图形](#-1)
	* 13.1. [dash](#dash)
	* 13.2. [cap](#cap)
	* 13.3. [TODO](#TODO-1)
	* 13.4. [Arc](#Arc)
* 14. [自定义图片](#-1)
* 15. [动画](#-1)
	* 15.1. [TODO](#TODO-1)
* 16. [命令汇总](#-1)
	* 16.1. [TODO](#TODO-1)
* 17. [音乐播放器](#-1)
	* 17.1. [TODO](#TODO-1)
* 18. [日历](#-1)
* 19. [外部数据](#-1)
	* 19.1. [TODO](#TODO-1)
	* 19.2. [天气](#-1)
	* 19.3. [TODO](#TODO-1)
* 20. [传感器](#-1)
	* 20.1. [TODO](#TODO-1)
* 21. [广播](#-1)
	* 21.1. [TODO](#TODO-1)
* 22. [锁屏设置](#-1)
* 23. [多语言配置](#-1)
	* 23.1. [TODO](#TODO-1)
* 24. [高级教程](#-1)
	* 24.1. [元素数组](#-1)
* 25. [其他相关](#-1)
	* 25.1. [TODO](#TODO-1)
* 26. [Aod-息屏](#Aod-)

<!-- vscode-markdown-toc-config
	numbering=true
	autoSave=true
	/vscode-markdown-toc-config -->
<!-- /vscode-markdown-toc --># 基本概念





##  1. <a name='TODO'></a>TODO
* 日历图标上的日期显示在哪里控制
* miwallpaper 和 wallpaper 区别
* 数字字符串转数字



##  2. <a name=''></a>概述
* 锁屏不设置背景的话，看到的就说解锁后的桌面背景


###  2.1. <a name='TODO-1'></a>TODO
* `useHardwareCanvas` 的应用场景


##  3. <a name='-1'></a>机型适配
###  3.1. <a name='TODO-1'></a>TODO
* 确定一下 屏幕密度 是不是 PPI 或者 DPI
* 缩放比例 Sr 是用 Ss 计算的？那 Ss 是什么？


##  4. <a name='-1'></a>数据类型
* 数值字符串可以直接进行数学运算


##  5. <a name='-1'></a>变量/全局变量/表达式/内置函数
* `#day_of_week` 取值范围是 1~7，所以 `#day_of_week-1` 是对应 `Date.getDay()`
* 不能用 `==` 比较字符串
* 字符串变量的 `expression` 如果使用字符串字面量，必须要有单引号
* 不能先定义变量再用变量命令修改变量。例如下面的不行
	```xml
    <Var name="testResume" expression="0" type="number" />

    <ExternalCommands>
        <Trigger action="init,resume">
            <VariableCommand name="testResume" expression="rand()" />
        </Trigger>
    </ExternalCommands>
	```
	此时 `testResume` 永远都是 0。

### 空字符串的判断
1. 对于普通的空字符串
	```xml
	<Var name="emptyStr" type="string" expression="''" />
	```
	判定如下
	* `!@emptyStr` 值是 1，符合预期。
	* `strIsEmpty(@emptyStr)` 值是 1，符合预期。
	* `strIsEmpty(!@emptyStr)` 值是 0，符合预期。
2. 对于普通的非空空字符串
	```xml
	<Var name="nonEmptyStr" type="string" expression="'6'" />
	```
	判定如下
	* `!@nonEmptyStr` 值是 0，符合预期。
	* `strIsEmpty(@nonEmptyStr)` 值是 0，符合预期。
	* `strIsEmpty(!@nonEmptyStr)` 值是 0 ，不符合预期。
3. 上面说是普通，如果是特殊的字符串，规则又不同。例如小部件闹钟接口的 `clock_enabled`，文档给的类型是字符串。在 `clock_enabled[0]` 是 1 的情况下，判定如下
	* `!@clock_enabled[0]` 值是空值，既不是 0 也不是 1，不符合预期。
	* `strIsEmpty(@clock_enabled[0])` 值是 0，符合预期。
	* `strIsEmpty(!@clock_enabled[0])` 是空值，既不是 0 也不是 1 ，不符合预期。
4. 不要对 `strIsEmpty` 直接去反，还是用 `==` 比较 1 或 0。


###  5.1. <a name='VarVariableCommand'></a>`<Var>` 和 `<VariableCommand>` 的区别
`<VariableCommand>` 只能由 `<Trigger>` 发起

####  5.1.1. <a name='-1'></a>单一变量（非数组）的情况
1. `<Var>` 并不是定义一个变量，它只是对一个值、另一个变量、一个表达式的引用。所以不能如下使用
	```xml
	<Var name="test1" expression="11" />

	<Button x="0" y="0" w="#view_width" h="#view_height" alignChildren="true">
		<Triggers>
			<Trigger action="up">
				<Var name="test1" expression="22" />
			</Trigger>
		</Triggers>
	</Button>
	```
	点击按钮后，`test1` 的值仍然是 11。
2. `<Var>` 只能是根据其 `expression` 中的变量或表达式的改变而改变，如果 `expression` 是常量，则无法改变。
3. `<VariableCommand>` 也不是修改 `<Var>` 中的值的，比如下面执行并不会修改 `<Var>` 的值
	```xml
	<Var name="test1" expression="11" />

	<Button x="0" y="0" w="#view_width" h="#view_height" alignChildren="true">
		<Triggers>
			<Trigger action="up">
				<VariableCommand name="test1" expression="22" />
			</Trigger>
		</Triggers>
	</Button>
	```
	点击按钮后，`test1` 的值仍然是 11。
4. 但是，`<VariableCommand>` 可以在第一次调用时定义一个变量，然后之后再使用同样的 `name` 调用时可以修改之前的变量值。下面是可行的
	```xml
	<Button x="0" y="0" w="#view_width" h="#view_height" alignChildren="true">
		<Triggers>
			<Trigger action="up">
				<VariableCommand name="test1" expression="11" />
				<VariableCommand name="test1" expression="22" delay="2000" />
			</Trigger>
		</Triggers>
	</Button>
	```
	初始时，`test1` 的值仍然是 0，点击按钮后立刻变成 11，两秒钟后变成 22。
5. 如果有同名的 `<Var>` 和 `<VariableCommand>`，则像上面的例子描述的，该变量永远都会是 `<Var>` 中定义的值
	```xml
    <Var name="num" expression="ifelse(#flag, 1, #num)" />

    <Text x="40" y="70" color="#000000" size="72" textExp="#num" />


    <Button x="0" y="0" w="#view_width" h="#view_height">
        <Triggers>
            <Trigger action="up">
                <FrameRateCommand rate="60" />
                <VariableCommand name="flag" expression="1" />
                <VariableCommand name="num" expression="0" />
            </Trigger>
        </Triggers>
    </Button>
	```
	1. `num` 初始值是 0，按下按钮后，`flag` 变为 1，`ifelse` 判断应该是第一项，也就是说 `Var` 定义的 `num` 应该是 1。
	2. 但紧接着的一条命令是 `<VariableCommand name="num" expression="0" />`，但这个并不会影响 `Var` 定义的 `num`，所以显示出的是 1。
6. TODO
	```xml
    <Var name="num" expression="ifelse(#flag, #num + 2, #num)" />

    <Text x="40" y="70" color="#000000" size="72" textExp="#num" />


    <Button x="0" y="0" w="#view_width" h="#view_height">
        <Triggers>
            <Trigger action="up">
                <FrameRateCommand rate="60" />
                <VariableCommand name="flag" expression="1" />
                <VariableCommand name="num" expression="2" />
            </Trigger>
        </Triggers>
    </Button>
	```
	加上 const 的情况
	```xml
    <Var name="num" expression="ifelse(#flag, #num + 2, #num)" const="true" />

    <Text x="40" y="70" color="#000000" size="72" textExp="#num" />


    <Button x="0" y="0" w="#view_width" h="#view_height">
        <Triggers>
            <Trigger action="up">
                <FrameRateCommand rate="60" />
                <VariableCommand name="flag" expression="1" />
                <VariableCommand name="num" expression="2" />
            </Trigger>
        </Triggers>
    </Button>
	```


####  5.1.2. <a name='-1'></a>数组的情况
1. `<VariableCommand>` 同样不能修改数组变量中的值，例如下面是不行的
	```xml
	<Var name="testNums" type="number[]" expression="" values="1,2,3" />

	<Button x="0" y="0" w="#view_width" h="#view_height" alignChildren="true">
		<Triggers>
			<Trigger action="up">
				<LoopCommand count="3" indexName="idx">
					<VariableCommand name="testNums" index="#idx" type="number[]"
						expression="#idx * #idx"
					/>
				</LoopCommand>
			</Trigger>
		</Triggers>
	</Button>
	```
	`testNums` 中的值永远是 1 2 3
2. 不使用循环直接修改某一项也不行
	```xml
	<VariableCommand name="testNums" index="1" type="number"
		expression="6"
	/>
	```
3. 但是，与单一变量中不同的时，此时不能直接使用 `<VariableCommand>` 定义变量数组，必须要先用 `<Var>` 声明同名数组。例如下面的是不行的
	```xml
	<!-- <Var name="testNums" type="number[]" size="3" /> -->

	<Button x="0" y="0" w="#view_width" h="#view_height" alignChildren="true">
		<Triggers>
			<Trigger action="up">
				<LoopCommand count="3" indexName="idx">
					<VariableCommand name="testNums" index="#idx" type="number[]"
						expression="#idx * #idx"
					/>
				</LoopCommand>
			</Trigger>
		</Triggers>
	</Button>
	```
	`testNums` 中的值都是 0。
4. 必须要先用 `<Var>` 声明同名的 **空** 数组
	```xml
	<Var name="testNums" type="number[]" size="3" />

	<Button x="0" y="0" w="#view_width" h="#view_height" alignChildren="true">
		<Triggers>
			<Trigger action="up">
				<LoopCommand count="3" indexName="idx">
					<VariableCommand name="testNums" index="#idx" type="number[]"
						expression="#idx * #idx"
					/>
				</LoopCommand>
			</Trigger>
		</Triggers>
	</Button>
	```
	点击之后，`testNums` 中的值都是变成 0 1 4。
5. 而且，`<Var>` 声明同名数组必须要设置 `size` 属性。下面这样是不行的
	```xml
	<Var name="testNums" type="number[]"  />
	```
6. 如果设置了 `size` 属性，但属性值小于 `<VariableCommand>` 赋值的次数，则该数组仍然只有 `size` 个数组项。例如
	```xml
	<Var name="testNums" type="number[]"  size="2" />

	<Button x="0" y="0" w="#view_width" h="#view_height" alignChildren="true">
		<Triggers>
			<Trigger action="up">
				<LoopCommand count="3" indexName="idx">
					<VariableCommand name="testNums" index="#idx" type="number[]"
						expression="#idx * #idx"
					/>
				</LoopCommand>
			</Trigger>
		</Triggers>
	</Button>
	```
	此时 `testNums` 不会有第三项，读取 `testNums[2]` 是值为默认的 0。
7. 注意，上面强调了 `<Var>` 声明的数组必须是空的，如果非空，则 `<VariableCommand>` 无法修改它的值。例如下面声明就不行
	```xml
	<Var name="testNums" type="number[]" expression="" values="1,2,3" size="3" />
	```


##  6. <a name='-1'></a>添加解锁
###  6.1. <a name='TODO-1'></a>TODO
* 动画是怎么定义运动的？


##  7. <a name='-1'></a>文本
* `textExp` 中不能进行数学运算
* `#textName.text_width` 和 `#textName.text_height` 属性可以获取 `<Text name="textName" />` 的宽度和高度。但注意，如果是多行文本时，`#textName.text_width` 获得的仍然是折行前的宽度，但 `#textName.text_height` 获得的时折行后的高度。
 

##  8. <a name='-1'></a>日期
* 格式化节气时，只有当天时某个节气日才会值，否则就是空串
* 时间戳起点是 1969.1.1 零点


##  9. <a name='-1'></a>组
* `layered="true"  clip="false"` 也会裁剪

###  9.1. <a name='TODO-1'></a>TODO
* 实践组命令
* 实践自定义函数


##  10. <a name='-1'></a>图片
* `actual_w` 和 `actual_h` 没用
* `tint` 空字符串会染成黑色

###  10.1. <a name='-1'></a>旋转
* `rotation` 也是绕 Z 轴，只不过它是顺时针，而 `rotationZ` 是逆时针
* pivot 默认是以图片坐上角为旋转轴；设定值的时候是以图片左上角为坐标原点

###  10.2. <a name='alignalignV'></a>align/alignV
1. 是指图片的坐标是相对于图片哪个位置，默认值是 `left`
2. 例如 `x="10"` 时：
	* `align="left"` 表示图片左边缘距离屏幕左边（或者设定其他参考系）为 10 像素
	* `align="right"` 表示图片右边缘距离屏幕左边（或者设定其他参考系）为 10 像素
	* `align="center"` 表示图片中间位置距离屏幕左边（或者设定其他参考系）为 10 像素
3. `alignV` 的三个值是 `top`、`center` 和 `bottom`，默认是 `top`。
4. 这两个值的设定都不能使用变量，不过可以有一些绕过的方法：
	* 改变距离左边的距离来模拟对齐
	* 添加三个不同对齐类型的元素，根据变量显示其中的某一个

###  10.3. <a name='-1'></a>色调（染色）
把图片中的像素改成指定的颜色

###  10.4. <a name='TODO-1'></a>TODO
* 数字图片映射中的 number 要设置什么？数字数组？
* 文本图片映射具体例子


##  11. <a name='-1'></a>笔刷
###  11.1. <a name='TODO-1'></a>TODO
* 完全不显示


##  12. <a name='-1'></a>图片变形
TODO


##  13. <a name='-1'></a>几何图形
* `fillColor` 不支持表达式。可以先把需要的表达式定义为变量，然后 `fillColor` 引用该变量。

###  13.1. <a name='dash'></a>dash
1. 描述虚线的线段和间隔的长度。
2. 比如期望虚线是线段和间隔都都是 10 像素，则可设置为 `dash="10,10"`；如果期望虚线是线段长一些而间隔短一些，例如分别是 20 像素和 10 像素，则可设置为 `dash="20,10"`。
3. 如果希望更复杂一些，比如是 10 线段跟着 10 间隔再跟着 20 线段再跟着 20 间隔，然后按照这个规律循环，则可设置为 `dash="10, 10, 20, 20"`。
4. 不写或只写一个数都是实线；写奇数个数值也是实线。

###  13.2. <a name='cap'></a>cap
* 方形 cap 的设定值是 `square`
* cap 会添加到线段尾端，而不是把线段尾端变成设定的 cap 形状，也就是说会增长线段。

###  13.3. <a name='TODO-1'></a>TODO
渐变

###  13.4. <a name='Arc'></a>Arc
1. 0 度是 3 点钟方向。
2. `sweep` 为正时是顺时针转动，为负时是逆时针转动。


##  14. <a name='-1'></a>自定义图片
TODO


##  15. <a name='-1'></a>动画
* `time` 不支持变量和表达式，`dtime` 支持
* 数组动画的数组不能像普通变量数组那样拆开写
	```xml
	<Array count="5" indexName="_ani">
		<Var name="arrayAni" size="5" index="#_ani" type="number[]">
			<VariableAnimation initPause="true" loop="false">
				<AniFrame value="-1 + #bottomAniSwitch" dtime="#_ani*100" easeType="BackEaseOut" />
				<AniFrame value="0" dtime="300+#_ani*100" />
				<Triggers>
					<Trigger action="end" condition="#arrayAni[9]==1">
						<FrameRateCommand rate="0" />
					</Trigger>
				</Triggers>
			</VariableAnimation>
		</Var>
	</Array>
	```
	不能写成
	```xml
	<Var name="arrayAni" index="0" size="5">
		<VariableAnimation initPause="true" loop="false">
			<AniFrame value="-1 + #bottomAniSwitch" time="0" easeType="BackEaseOut" />
			<AniFrame value="0" time="300" />
		</VariableAnimation>
	</Var>
	<Var name="arrayAni" index="1">
		<VariableAnimation initPause="true" loop="false">
			<AniFrame value="-1 + #bottomAniSwitch" time="0" easeType="BackEaseOut" />
			<AniFrame value="0" time="300" />
		</VariableAnimation>
	</Var>
	<Var name="arrayAni" index="2">
		<VariableAnimation initPause="true" loop="false">
			<AniFrame value="-1 + #bottomAniSwitch" time="0" easeType="BackEaseOut" />
			<AniFrame value="0" time="300" />
		</VariableAnimation>
	</Var>
	<Var name="arrayAni" index="3">
		<VariableAnimation initPause="true" loop="false">
			<AniFrame value="-1 + #bottomAniSwitch" time="0" easeType="BackEaseOut" />
			<AniFrame value="0" time="300" />
		</VariableAnimation>
	</Var>
	<Var name="arrayAni" index="4">
		<VariableAnimation initPause="true" loop="false">
			<AniFrame value="-1 + #bottomAniSwitch" time="0" easeType="BackEaseOut" />
			<AniFrame value="0" time="300" />
		</VariableAnimation>
	</Var>
	```
* `<Array>` 里面使用动画的 bug：
	1. 如果在 `<Array>` 里面使用元素动画，则无法触发元素变化。
	2. 如果在 `<Array>` 里面定义动画变量然后用在元素上，则动画变量值不会改变。
	3. 如果要给 `<Array>` 里面元素设置动画，需要在 `<Array>` 外面定义动画变量，然后用在元素上。
* `play` 的时间参数不需要和关键帧时间匹配
* 源动画 `<Image>` 中的坐标是原图坐标，`<Source>` 中的坐标是相对于原图的坐标
* 等比缩放。下面最初完全不现实，然后在一秒钟之内夸大到原图尺寸，支持保持到第四秒，然后再用一秒钟扩大到原图两倍
	```xml
	<Image x="300" y="300" src="0c.png">
		<ScaleAnimation loop="true">
			<Item value="0" time="0" />
			<Item value="1" time="1000" />
			<Item value="1" time="4000" />
			<Item value="2" time="5000" />
		</ScaleAnimation>
	</Image>
	```
* `<RotationAnimation>` 以左上角为轴，设置 pivot 没效果
* 一个元素的同一种动画只会有最后一个设置的生效，至少位置动画是这样。例如下面的自会往下移动
	```xml
	<Image name="wao" x="200" y="200" src="bg1.jpg" >
		<PositionAnimation initPause="true" loop="false" >
			<Item x="0" time="0" easeType="ExpoEaseOut"/>
			<Item x="300" time="2000"/>
		</PositionAnimation>
		<PositionAnimation initPause="true" loop="false" >
			<Item y="0" time="0" easeType="ExpoEaseOut"/>
			<Item y="300" time="2000"/>
		</PositionAnimation>
	</Image>
	```
* `tags` 写多个不会出错，但只会有第一个生效
	```xml
	<AnimationCommand target="wao" command="play" tags="pos2, pos1" />
	```
* 写了 tag 的，触发时就必须要指定 tags 才能触发。而 tags 只能设置一个，所以带 tag 的动画就只能单独运行。但是，可以多个动画指定同一个 tag 来一起执行，例如下面两个动画都可以通过 `tags="pos"` 来同时执行
	```xml
	<Image name="wao" x="200" y="200" src="bg1.jpg" >
		<PositionAnimation tag="pos2" initPause="true" loop="false" >
			<Item x="0" time="0" easeType="ExpoEaseOut"/>
			<Item x="300" time="2000"/>
		</PositionAnimation>
		<AlphaAnimation tag="pos2">
			<Item value="255" time="0"/>
			<Item value="100" time="1000"/>
			<Item value="255" time="2000"/>
		</AlphaAnimation>
	</Image>
	```
* 直接用动画变量名 `memoryAni` 作为变化起点，`memoryAni` 初始值是 0，所以动画变量 `memoryAni` 就是从 0 变化到 `memory_Occupied`
	```xml
	<Var name="memoryAni">
		<VariableAnimation loop="false" initPause="true">
			<AniFrame value="#memoryAni" time="0" easeType="QuadEaseOut" />
			<AniFrame value="#memory_Occupied" time="300" />
		</VariableAnimation>
	</Var>
	```

* 返回手势
```xml
<Group name="Return" >
    <Image x="#about*1080" y="#touch_begin_y" w="#ReturnMove*0.5" h="858" alignV="center" rotation="#about*180" pivotY="429" src="2c.png" />
    <Image x="#ReturnMove/4+#about*(1080-#ReturnMove/2)" y="#touch_begin_y" align="center" alignV="center" src="3c.png" visibility="#ReturnMove }= 100" />
	
	<!-- 用来计算拖动（#ReturnDown==1）和放手（#ReturnDown==0）时提示图标的移动位置 -->
	<!-- ReturnMove 刚开始是 0，
		松手回到原位后因为 ReturnBack 变成 1，所以 ReturnMove 也回到 0 
		其他时候都是大于 0
		* (#ReturnMove } 0) 有用吗？(1 - #ReturnBack) 为 0 时，(#ReturnMove } 0) 也为 0
	-->
    <Var name="ReturnMove" 
		expression="ifelse(
						#ReturnDown==1, 
						min( abs(#touch_begin_x - #touch_x), 168 ),
						min( abs(#touch_begin_x - #touch_x), 168 ) 
							* (1 - #ReturnBack) 
							* (#ReturnMove } 0)
					)"
	/>

	<!-- 松手后提示图标返回原位的动画变量 -->
    <Var name="ReturnBack">
        <VariableAnimation initPause="true" loop="false">
            <Item value="0" time="0" easeType="QuadEaseOut" />
            <Item value="1" time="200" />
        </VariableAnimation>
    </Var>

    <Button w="1080" h="#screen_height" >
        <Triggers>
            <Trigger action="down" condition="#touch_x{50 || #touch_x}1030" >
                <VariableCommand name="ReturnDown" expression="1"/>
                <VariableCommand name="about" expression="#touch_x}540"/>
            </Trigger>
            <Trigger action="up,cancel" >
                <VariableCommand name="ReturnDown" expression="0" />
                <AnimationCommand target="ReturnBack" command="play" />
                <!-- 当移动距离大于100px时，执行动画 -->
                <AnimationCommand target="" command="play" condition="#ReturnMove}100" />
            </Trigger>
        </Triggers>
    </Button>
</Group>
```

### 事件机制
1. 一个 `VariableAnimation` 对应一个事件对象，而不是一个事件注册。
2. 也就是说，比如如果定义了动画时常为一秒，结束后触发一个行为，那你在一秒钟之内第二次触发动画，第二次动画就停止了，从第二次触发开始重新执行动画，而不会执行两次动画。因为这里只有一个事件对象，也就是 `VariableAnimation` 定义的那个。
3. 在比如 JS 中的 `addEventListener` 是注册事件监听，环境在你每次触发事件都会帮你建立一个独立的事件对象，所以才可能互不影响的独立进行。
4. 所以如果在这里想连续的执行独立的延迟动画，就要定义对应数量的 `VariableAnimation`，直接写或者通过数组。

###  15.1. <a name='TODO-1'></a>TODO
* AniFrame 和 Item 的区别
* `current_frame` 只有 0 和 -1 两个状态，最终结束时是 -1，之前都是 0
* 获取不到数组动画每个动画变量的值，显示的三个值都是 0
	```xml
	<Text x="150" y="500" color="#ffffff" size="48" textExp="round(#arrayAni[0])"/>
	<Text x="150" y="600" color="#ffffff" size="48" textExp="round(#arrayAni[1])"/>
	<Text x="150" y="700" color="#ffffff" size="48" textExp="round(#arrayAni[2])"/>

	
	<Array count="6" indexName="_ani">
		<Var name="arrayAni" size="6" index="#_ani" type="number[]">
			<VariableAnimation initPause="true" loop="false">
				<Item value="0" time="0" easeType="CubicEaseOut"/>
				<Item value="100" time="600"/>
			</VariableAnimation>
		</Var>
	</Array>

	<Button x="540" y="0" w="540" h="540">
		<Triggers>
			<Trigger action="up">
				<!-- 播放第一个动画；targetIndex 从 0 开始到 5，共 6 个 -->
				<AnimationCommand target="arrayAni" targetIndex="0" command="play" />
				<!-- 播放第二个动画 -->
				<AnimationCommand target="arrayAni" targetIndex="1" command="play" delay="300"/>
			</Trigger>
		</Triggers>
	</Button>
	```
* 两处延迟都无效，而且 `numAni1` 一开始就会自动播放
	```xml
	<?xml version="1.0" encoding="utf-8"?>
	<Lockscreen version="1" frameRate="30" screenWidth="1080"  >
		<Text x="150" y="500" color="#ffffff" size="48" textExp="'numAni: ' + round(#numAni)"/>
		<Text x="150" y="600" color="#ffffff" size="48" textExp="'numAni1: ' + round(#numAni1)"/>

		<Var name="numAni1">
			<VariableAnimation initPause="true" loop="false">
				<Item value="0" time="0" />
				<Item value="100" time="3000" />
			</VariableAnimation>
		</Var>


		<Var name="numAni">
			<VariableAnimation name="numAniVar" initPause="true" loop="false">
				<Item value="0" time="0" />
				<Item value="100" time="3000" />
				<Triggers>
					<Trigger action="end">
						<!-- <VariableCommand name="delay" expression="1000"/> -->
						<AnimationCommand target="numAni1" command="play" />
					</Trigger>
				</Triggers>
			</VariableAnimation>
		</Var>

		<Button x="0" y="0" w="1080" h="#screen_height">
			<Triggers>
				<Trigger action="up">
					<VariableCommand name="delay" expression="1000"/>
					<AnimationCommand target="numAni" command="play" />
				</Trigger>
			</Triggers>
		</Button>	
	</Lockscreen>
	```
* 源动画。0c.png 完全不显示，1c 不是从两秒开始显示，而是直接显示并持续两秒，之后是 2c 持续四秒，最后是 3c 持续六秒。
	```xml
	<Image x="300" y="300" src="0c.png">
		<SourcesAnimation>
			<Source x="100" y="0" src="1c.png" time="2000"/>
			<Source x="0" y="100" src="2c.png" time="6000"/>
			<Source x="100" y="100" src="3c.png" time="12000"/>
		</SourcesAnimation>
	</Image>
	```


##  16. <a name='-1'></a>命令汇总
* ExternCommand 是向外部程序（MIUI 自身的一些程序）发送执行的命令，例如打开手电；ExternalCommand 设置外部事件发生时，这里要执行的命令，例如在按下屏幕或开启屏幕时要触发什么动画。IntentCommand 和 ExternCommand 类似，但是更全面，而且可以唤起第三方应用。
* 手电筒切换
	```xml
	<Image x="500" y="1000" src="flashlight.png" srcid="#lightSwitch"/>

	<Button x="0" y="0" w="1080" h="#screen_height">
		<Triggers>
			<Trigger action="up" >
				<VariableCommand name="lightSwitch" expression="!(#lightSwitch)"/>
				<IntentCommand action="miui.intent.action.TOGGLE_TORCH" broadcast="true">
					<Extra name="miui.intent.extra.IS_ENABLE" type="boolean" expression="ifelse(int(@__miui_version_code)}=8,#lightSwitch,1)"/>
				</IntentCommand>
				
			</Trigger>
		</Triggers>
	</Button>
	```


###  16.1. <a name='TODO-1'></a>TODO
* `<Command target="img" property="visibility" value="false" />` 不能改变可见性，必须要 `<Command target="img.visibility" value="false"  />`
* 改变变量值之后又立刻恢复到之前的值
	```xml
	<Text x="150" y="500" color="#ffffff" size="48" textExp="#age"/>

	<Var name="age" expression="22" type="number" />


	<Button x="0" y="0" w="1080" h="#screen_height">
		<Triggers>
			<Trigger action="up" >
				<VariableCommand name="age" expression="33" />
			</Trigger>
		</Triggers>
	</Button>
	```
* 音频播放不了 `<SoundCommand sound="music.wav" volume="0.5" loop="false" keepCur="true" />`
* resume 是点亮屏幕而不是解锁屏幕？下面全程都看不到图片
	```xml
	<Image name="img" x="200" y="200" src="bg1.jpg"></Image>

	<Button x="0" y="0" w="1080" h="#screen_height">
		<Triggers>
			<Trigger action="up" >
				<Command target="img.visibility" value="false" />
				<ExternCommand command="unlock" delay="1000" />
			</Trigger>
		</Triggers>
	</Button>


	<ExternalCommands>
		<Trigger action="resume">
			<Command target="img.visibility" value="false" />
		</Trigger>
		<Trigger action="pause">
			<Command target="img.visibility" value="true" />
		</Trigger>
	</ExternalCommands>
	```
* 桌面插件相关
* `<Extra` 是什么
* `IntentCommand` 和 `ExternCommand` 的区别


##  17. <a name='-1'></a>音乐播放器
###  17.1. <a name='TODO-1'></a>TODO
* 实践
* `name` 为 `music_pause` 不显示，这个逻辑是哪里控制的？
	```xml
	<MusicControl name="music_control" y="800" w="1080" h="226" autoShow="true" defAlbumCover="b_torchn.png" enableLyric="true" updateLyricInterval="100" visibility="true" >

		<Image x="40" y="0" w="1000" h="226" src="bg1.jpg" />
		
		<Group x="40" w="226" h="226" layered="true">
			<Image name="music_album_cover" w="226" h="226" src="b_camerap.png" />
			<Image w="226" h="226" src="b_cameran.png" xfermode="dst_in" />
		</Group>

		<Text x="296" y="61" w="674" alignV="center" textExp="ifelse(strIsEmpty(@music_control.title),'暂无音乐',@music_control.title)" color="#000000" size="39" marqueeSpeed="30" bold="true"/>
		<Text x="296" y="117" w="350" alignV="center" textExp="ifelse(strIsEmpty(@music_control.artist),'--',@music_control.artist)" color="#000000" size="36" marqueeSpeed="30" alpha="128" />
		<Text x="296" y="169" w="350" alignV="center" textExp="ifelse(strIsEmpty(@music_control.title),'--:--/--:--',formatDate('mm:ss / ',#music_control.music_position)+formatDate('mm:ss',#music_control.music_duration))" color="#000000" size="33" marqueeSpeed="30" alpha="128" />

		<Button name="music_prev" x="#screen_width - 428" y="76" w="120" h="150" align="right" alignChildren="true">
			<Normal>
				<Image x="60" y="75" w="150" h="150" align="center" alignV="center" src="1.png" />
			</Normal>
			<Pressed>
				<Image x="60" y="75" w="150" h="150" align="center" alignV="center" src="1c.png" alpha="128"/>
			</Pressed>
		</Button>

		<Button name="music_play" x="#screen_width - 308" y="76" w="120" h="150" align="right" alignChildren="true">
			<Normal>
				<Image x="60" y="75" w="150" h="150" align="center" alignV="center" src="2.png" />
			</Normal>
			<Pressed>
				<Image x="60" y="75" w="150" h="150" align="center" alignV="center" src="2c.png" alpha="128"/>
			</Pressed>
		</Button>

		<Button name="music_pause" x="#screen_width - 188" y="76" w="120" h="150" align="right" alignChildren="true">
			<Normal>
				<Image x="60" y="75" w="150" h="150" align="center" alignV="center" src="2.png" />
			</Normal>
			<Pressed>
				<Image x="60" y="75" w="150" h="150" align="center" alignV="center" src="2c.png" alpha="128"/>
			</Pressed>
		</Button>

		<Button name="music_next" x="#screen_width - 68" y="76" w="120" h="150" align="right" alignChildren="true">
			<Normal>
				<Image x="60" y="75" w="150" h="150" align="center" alignV="center" src="4.png" />
			</Normal>
			<Pressed>
				<Image x="60" y="75" w="150" h="150" align="center" alignV="center" src="4c.png" alpha="128"/>
			</Pressed>
		</Button>
	</MusicControl>
	```


##  18. <a name='-1'></a>日历
* 日历第一列是周日。
* 只显示当月的日期，不填满所有格子来显示上个月和下个月的。
* 根据某天的日期和星期（0-6）计算当月一号星期几的 JS 算法
	```js
	((day + 7) - (date % 7 - 1)) % 7;
	```
	1. 对日期取模后再减一，算出第一周的星期值为 day 的那天距离一号的天数 n；
	2. 如果那天和一号在同一周，那它的星期值就大于等于一号的星期值，day - n 就算出一号的星期值；
	3. 如果那天在一号的下一周，那它的星期值就小于一号的星期值，所以先加 7 再减 n 然后取模；
	4. 统一两种情况，所以直接加 7 再减 n 然后取模。
* `formatDate` 转换的时间形式的时区是根据手机当前设定的时区。


##  19. <a name='-1'></a>外部数据
###  19.1. <a name='TODO-1'></a>TODO
* BinderCommand


###  19.2. <a name='-1'></a>天气
```xml
<ExternalCommands>
    <Trigger action="init,resume">
        <!-- ContentProvider接口在切屏时必须主动更新一次  -->
        <BinderCommand name="WeatherProvider" command="refresh" />
    </Trigger>
</ExternalCommands>
<VariableBinders>
    <!-- MIUI天气代码；uri 老接口：content://weather/weather，旧主题更新时请更换为新接口：content://weather/actualWeatherData/1 -->
    <ContentProviderBinder name="WeatherProvider" uri="content://weather/actualWeatherData/1" columns="city_id,city_name,weather_type,aqilevel,description,temperature,temperature_range,forecast_type,tmphighs,tmplows,wind,humidity,sunrise,sunset,pressure,weathernamesfrom,publish_time,temperature_unit,somatosensory,kinect" countName="hasweather">
        <!-- 城市北纬东经 -->
        <Variable name="city_id" type="string" column="city_id"/>
        <!-- 城市/街道名称 -->
        <Variable name="weather_location" type="string" column="city_name"/>
        <!-- 天气类型（实时） -->
        <Variable name="weather_id" type="int" column="weather_type"/>
        <Variable name="weather_type" type="string[]" column="weather_type"/>
        <!-- 今日温度 -->
        <Variable name="weather_temperature" type="string" column="temperature"/>
        <!-- 今日温度区间（20℃~30℃） -->
        <Variable name="weather_temperature_range" type="string" column="temperature_range"/>
        <!-- 天气现象（实时）：晴 -->
        <Variable name="weather_description" type="string" column="description"/>
        <!-- 日出时间 -->
        <Variable name="weather_sunrise" type="int" column="sunrise"/>
        <!-- 日落时间 -->
        <Variable name="weather_sunset" type="int" column="sunset"/>
        <!-- 风力 -->
        <Variable name="weather_wind" type="string" column="wind"/>
        <!-- 气压 -->
        <Variable name="weather_pressure" type="int" column="pressure"/>
        <!-- 湿度 -->
        <Variable name="weather_humidity" type="int" column="humidity"/>
        <!-- 天气类型（预报） -->
        <Variable name="weather_forecast_type_test" type="string[]" column="forecast_type"/>
        <!-- 天气现象（预报） -->
        <Variable name="weather_weathernamesfrom" type="string[]" column="weathernamesfrom"/>
        <!-- 最高温度 -->
        <Variable name="weather_temphigh" type="string[]" column="tmphighs"/>
        <!-- 最低温度 -->
        <Variable name="weather_templow" type="string[]" column="tmplows"/>
        <!-- 实时天气信息发布时间 -->
        <Variable name="weather_publish_time" type="string" column="publish_time"/>
        <!-- 气温单位，1代表摄氏度，0代表华氏度 -->
        <Variable name="weather_temperature_unit" type="int" column="temperature_unit" />
        <!-- AQI等级 -->
        <Variable name="weather_aqi" type="int" column="aqilevel"/>
        <Trigger>
            <!-- 空气质量 -->
            <VariableCommand name="air_quality"  type="string"
				expression="ifelse(
					#weather_aqi }= 0  ** #weather_aqi {= 50,  '空气优',
					#weather_aqi } 50  ** #weather_aqi {= 100, '空气良好',
					#weather_aqi } 100 ** #weather_aqi {= 150, '轻度污染',
					#weather_aqi } 150 ** #weather_aqi {= 200, '中度污染',
					#weather_aqi } 200 ** #weather_aqi {= 300, '重度污染',
					#weather_aqi } 300, '严重污染', 
					'获取信息异常'
				)" 
			/>
            <!-- 天气现象简化版；可用于天气图标展示。例如：srcid="#weatherId" -->
            <VariableCommand name="weatherId" 
				expression="ifelse(
					#weather_id } 25 || #weather_id { 0, 0, 
					(#weather_id }= 4 ** #weather_id {= 6 || #weather_id }= 8 ** #weather_id {= 11 || #weather_id == 25), 4,
					#weather_id }= 13 ** #weather_id {= 17, 13,
					#weather_id }= 18 ** #weather_id {= 21 || #weather_id == 23, 18,
					#weather_id
				)"
			/>
        </Trigger>
    </ContentProviderBinder>
    <ContentProviderBinder name="WeatherAqi" dependency="WeatherProvider" uriFormat="content://weatherinfo/aqi/%s" uriParas="@city_id" columns="aqi,pm25,pm10,so2,no2" countName="hasweatherinfo">
        <Variable name="aqi" type="int" column="aqi"/>
        <Variable name="pm25" type="int" column="pm25"/>
        <Variable name="no2" type="int" column="no2"/>
        <Variable name="pm10" type="int" column="pm10"/>
        <Variable name="so2" type="int" column="so2"/>
    </ContentProviderBinder>
</VariableBinders>

<!-- 把数据以文本的方式展示出来 -->
<Text x="100" y="1000" size="38" multiLine="true" color="#ffffff" 
	textExp="
		'weather_temperature: ' + @weather_temperature + '\n'
		+ 'weather_sunrise: ' + #weather_sunrise + '\n'
		+ 'air_quality: ' + @air_quality + '\n'"
/>

<Image x="100" y="1200" src="weather/weather.png" srcid="#weatherId"/>

<Array count="5" indexName="__w" >
    <Text x="100" y="1400+60*#__w"  color="#FFFFFF" size="40" textExp="@weather_type[#__w]"/>
</Array>
```

###  19.3. <a name='TODO-1'></a>TODO
* 消息通知 不显示，hasnotifications 是 1. List 是什么
* 天气 weather_forecast_type 不显示
* 天气 demo 里面有 `weather_description`，但实测并没有，而且字段列表里也没有
* 语音文字没效果
* 待办事件是在日历里创建的那个？建了一个也没有数据


##  20. <a name='-1'></a>传感器
###  20.1. <a name='TODO-1'></a>TODO
* 所有传感器的值都一直是0
	```xml
	<VariableBinders>
		<SensorBinder type="gravity"  rate="2">
			<Variable name="gravity_x" index="0"/>
			<Variable name="gravity_y" index="1"/>
			<Variable name="gravity_z" index="2" />
		</SensorBinder>
	</VariableBinders>

	<Text x="143" y="1000" size="48" color="#b2582d" textExp="'gravity_x: ' + #gravity_x" />
	<Text x="143" y="1100" size="48" color="#b2582d" textExp="'gravity_y: ' + #gravity_y" />
	<Text x="143" y="1200" size="48" color="#b2582d" textExp="'gravity_z: ' + #gravity_z" />
	````


##  21. <a name='-1'></a>广播
###  21.1. <a name='TODO-1'></a>TODO
* action 是不是随便填？我把回到未来里面的 set 改成 set123 也可以同步壁纸


##  22. <a name='-1'></a>锁屏设置
没看懂怎么用，建立这个文件也没什么效果


##  23. <a name='-1'></a>多语言配置
###  23.1. <a name='TODO-1'></a>TODO
现在在切换语言后必须重新应用主体才能改变


##  24. <a name='-1'></a>高级教程
###  24.1. <a name='-1'></a>元素数组
`count` 不支持表达式


##  25. <a name='-1'></a>其他相关
* 全机型壁纸自适应算法 文档中的 scale 是错的
	```xml
	<Image name="i_bg" src="3c.png" 
		x="#screen_width/2" y="#screen_height/2" align="center" alignV="center"
		pivotX="#i_bg.bmp_width/2" pivotY="#i_bg.bmp_height/2" 
		scale="max(#screen_width/#i_bg.bmp_width,#screen_height/#i_bg.bmp_height)" 
	/>
	```

###  25.1. <a name='TODO-1'></a>TODO
* 在百变壁纸为时钟插件添加大背景  时钟插件怎么弄
* 倒计时
* 摇一摇调出 NFC 界面


##  26. <a name='Aod-'></a>Aod-息屏
TODO