# 电量


## 数据获取
```xml
<VariableBinders>
    <ContentProviderBinder name="getPowerData"
        uri="content://com.miui.securitycenter.widgetProvider/getPowerData"
        columns="leftChargeTime,enduranceTime,powerSaveModeStatus,quickChargeStatus,chargestate"
        countName="hasGetPowerData">
        <!-- 预计充满时间/ms -->
        <Variable name="_leftChargeTime" type="long" column="leftChargeTime" />
        <!-- 预计可用时间/ms -->
        <Variable name="_enduranceTime" type="long" column="enduranceTime" />
        <!-- 是否快充 -->
        <Variable name="_quickChargeStatus" type="int" column="quickChargeStatus" />
        <!-- 充电状态 -->
        <Variable name="_chargestate" type="int" column="chargestate" />
        <!-- 是否开启省电模式 -->
        <Variable name="_powerSaveModeStatus" type="int" column="powerSaveModeStatus" />
    </ContentProviderBinder>

    <!-- 当前电量 -->
    <BroadcastBinder action="android.intent.action.BATTERY_CHANGED">
        <Variable name="batteryLevel" type="int" extra="level" />
        <Trigger>
            <BinderCommand name="getPowerData" command="refresh" />
            <AnimationCommand target="Fra" command="play" />
        </Trigger>
    </BroadcastBinder>

    <ContentProviderBinder name="getWearableAndHeadSetData"
        uri="content://com.miui.securitycenter.widgetProvider/getWearableAndHeadSetData"
        columns="wearableBattery,wearableType,headsetBattery"
        countName="hasGetWearableAndHeadSetData">
        <!-- 穿戴设备电量，连接状态为真实电量，如果未连接，为null -->
        <Variable name="_wearableBattery" type="string" column="wearableBattery" />
        <!-- 穿戴设备类型：１：手环 ２：手表。 -1 是都没有 -->
        <Variable name="_wearableType" type="int" column="wearableType" />
        <!-- 耳机电量，连接时为耳机电量，未连接时为-1 -->
        <Variable name="_headsetBattery" type="int" column="headsetBattery" />
    </ContentProviderBinder>
</VariableBinders>
```
```xml
<BinderCommand name="getPowerData" command="refresh" />
<BinderCommand name="getWearableAndHeadSetData" command="refresh" />
```


## 字段说明



## 预计充满时间格式化出小时和分钟数值
```xml
<Var name="leftChargeTimeHours" expression="int(#_leftChargeTime/3600000)" />
<Var name="leftChargeTimeMinutes" expression="int(#_leftChargeTime/60000)%60" />
<Var name="leftChargeTime" type="string"
    expression="
    ifelse(
        #batteryLevel == 100, 
        '已充满',
        ifelse(#leftChargeTimeHours, #leftChargeTimeHours+'小时', '') +
            #leftChargeTimeMinutes+'分钟充满')
    )" 
/>
```


## 显示电量/充电信息
未充电状态或者充电状态但已经充满时，`batteryInfo` 显示为预计可用多久，否则显示还有多久充满。TODO 两种时分的数值类型
```xml
<Group name="formatBatteryInfo">
    <!-- 预计可用时间 时/分 -->
    <Var name="enduranceHour" type="string"
        expression="ifelse(
            int(#_enduranceTime/3600000) != 0,
            int(#_enduranceTime/3600000)+'H',
            ''
        )"
    />
    <Var name="enduranceMinute" type="string"
        expression="ifelse(
            int((#_enduranceTime%3600000)/60000) != 0,
            int((#_enduranceTime%3600000)/60000)+'M',
            int(#_enduranceTime/3600000) == 0 ** int((#_enduranceTime%3600000)/60000) == 0,
            '/',
            ''
        )"
    />

    <!-- 剩余充电时间 时/分 -->
    <Var name="leftChargeHour" type="string"
        expression="ifelse(
            int(#_leftChargeTime/3600000) != 0,
            int(#_leftChargeTime/3600000) + 'H',
            ''
        )"
    />
    <Var name="leftChargeMinute" type="string"
        expression="ifelse(
            int((#_leftChargeTime%3600000)/60000) != 0,
            int((#_leftChargeTime%3600000)/60000) + 'M',
            int(#_leftChargeTime/3600000)==0 ** int((#_leftChargeTime%3600000)/60000)==0,
            '/',
            ''
        )"
    />

    <!-- 应该显示续航信息还是显示多久充满的信息 
        未充电状态或者充电状态但已经充满时，值为 1，表示需要显示续航信息
    -->
    <Var name="isShowEnduranceInfo"
        expression="ifelse(
            #_chargestate == 0 || (#_chargestate == 1 ** #batteryLevel==100),
            1,
            0
        )"
    />

    <Var name="batteryTip" type="string"
        expression="ifelse(
            #isShowEnduranceInfo,
            '预计可用', 
            '充电中'
        )"
    />
    <Var name="batteryInfo" type="string"
        expression="ifelse(
            #isShowEnduranceInfo,
            @batteryTip + @enduranceHour + @enduranceMinute,
            @batteryTip + @leftChargeHour + @leftChargeMinute + '充满'
        )"
    />
</Group>
```


## 跳转
```xml
<IntentCommand action="android.intent.action.MAIN"
        package="com.miui.securitycenter"
        class="com.miui.powercenter.PowerMainActivity" />
</Trigger>
```
