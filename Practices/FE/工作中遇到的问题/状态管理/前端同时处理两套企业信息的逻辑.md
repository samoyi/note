# 前端同时处理两套企业信息的逻辑


<!-- TOC -->

- [前端同时处理两套企业信息的逻辑](#前端同时处理两套企业信息的逻辑)
    - [之前的逻辑——不存在企业身份切换](#之前的逻辑不存在企业身份切换)
    - [新的需求——要求同时维护两个企业的数据](#新的需求要求同时维护两个企业的数据)
    - [两套企业数据](#两套企业数据)
        - [判断是否正在访问不同企业](#判断是否正在访问不同企业)
        - [维护两套企业数据](#维护两套企业数据)
        - [切换为 B 企业](#切换为-b-企业)

<!-- /TOC -->


## 之前的逻辑——不存在企业身份切换
1. 企业影像库前端本来只需要展示一个企业的数据，如果需要展示另一个企业的，就需要退出并重新登录选择其他企业。
2. 所以本来在整个体系内只会同时存在一个企业的数据。
3. 如果以 A 企业的身份登录后，再通过链接访问到 B 企业的主页，此时会请求到 B 企业的信息，覆盖掉 A 企业的。
4. 但是本地保存的企业 ID 并不会被覆盖，仍然是 A 企业的，所以在进行其他操作或者跳转时，仍然是以 A 企业的身份进行的。
5. 这里看起来没什么问题，只有重登录才会触发真正的切换企业，也就是本地企业 ID 的改写。而只是浏览其他企业的主页的话，则只在主页范围内展示其他企业，登录状态并不会变化。


## 新的需求——要求同时维护两个企业的数据
1. 后来的新需求是，以 A 企业登录并访问 B 企业时，如果要进行其他操作，就要提示用户切换为 B 企业。
2. 而这个提示切换企业的界面，要同时展示 A 企业和 B 企业的信息，所以之前 B 企业覆盖 A 企业信息的逻辑就行不通了。
3. 后来进一步的需求，除了这个切换界面，还要在其他地方同时展示 A 企业和 B 企业的信息。比如在通过链接访问到 B 企业时，虽然企业主页区域展示 B 企业的信息，但在顶部菜单中，还要展示 A 企业的基本信息。


## 两套企业数据
### 判断是否正在访问不同企业
1. 首先需要判断当前是否是 A 企业登录但正在访问 B 企业的情况。
2. 方法就是在进入应用后，判断如果 URL 中有企业 ID 并且和本地保存的企业 ID 不同，就证明是这种情况。

### 维护两套企业数据
1. 现在需要明确的区分出两套企业数据：登录的企业和浏览的企业。
2. 因此前端在 store 使用两个命名明确的对象来保存。
3. 同时，相关的，要有命名明确的两个 state 属性来保存两个企业 ID，以及命名明确的两套 mutation 来设置不同的企业数据。
4. 对于请求企业信息的 action 还是同一个，只不过需要传不同的企业 ID。

### 切换为 B 企业
1. 把 A 企业的数据替换为 B 企业的。
2. 把 A 企业的企业 ID 替换为 B 企业的。
3. 清空 B 企业的企业信息和企业 ID。