/*! Wed Nov 22 2017 15:42:10 GMT-0600 (CST) * Copyright (c) 2017 Creative Market. All Rights Reserved. */
define("report",["require","exports","module","jquery","vendor/jquery/select2","underscore","shared/util","shared/plugins/modal"],function(t,e,n){var o=t("jquery"),i=(t("vendor/jquery/select2"),t("underscore")),a=t("shared/util");t("shared/plugins/modal");e.init=i.once(function(){o(function(){var t=o("#input-report-reason");o("body").on("click",".report-item",function(e){e.preventDefault(),o(this).blur();var n=o(this).data("type"),i=o("#modal-report");if("Product"===n)i.find("form").attr("action","/ajax/add/report/item/"+o(this).data("context")+"/"+o(this).data("id"));else{if("Comment"!==n)return!1;i.find("form").attr("action","/ajax/add/report/comment/"+o(this).data("context")+"/"+o(this).data("parent")+"/"+o(this).data("id"))}return i.find("span:not(.close-btn)").html(n),i.modal({tracking:{Type:"Report "+n}}),t.select2({width:"100%",containerCssClass:"btn btn-grey",minimumResultsForSearch:1/0}),!1}),t.on("change",function(){o("#reporting-reasons div").hide(),o("#"+o(this).find("option:selected").data("id")).show()}),o("#modal-report form").on("submit",function(t){t.preventDefault();var e=o(this),n=e.find("select");return n.tipsy("hide"),null===n.val()?(a.showThenHideTipsy(e,"Please select a reason"),!1):"Objectionable Content"===n.val()&&(o.post(o(this).attr("action"),o(this).serialize(),function(t){return"object"!=typeof t?void a.showThenHideTipsy("#modal-report button.btn","Unknown Error"):void("success"===t.status?(n.val(""),o("#modal-report .send-report").hide(),o("#modal-report .success").show(),o("#modal-report").modal("hide",{delay:5e3})):a.showThenHideTipsy("#modal-report button.btn",t.msg))}),!1)})})})}),define("mute",["require","exports","module","jquery","underscore","shared/form"],function(t,e,n){var o=t("jquery"),i=(t("underscore"),t("shared/form"));e.init=function(){var t=o(".mute-notifications"),e=o(".pre-mute-notifications");e.length&&i.reskinCheckboxes(e),t.length&&(i.reskinCheckboxes(t),o("input",t).on("change",function(){o.ajax("/ajax/mute-notification/"+o(this).data("context")+"/"+(o(this).is(":checked")?1:0),{type:"post"})}))}}),define("comments",["require","jquery","common","config","event_bus","report","mute","shared/models/session","shared/util","shared/loading","shared/plugins/mentions"],function(t){var e=t("jquery"),n=(t("common"),t("config"),t("event_bus")),o=t("report"),i=t("mute"),a=(t("shared/models/session"),t("shared/util")),s=t("shared/loading"),r=t("shared/plugins/mentions"),c={};return c.refresh=function(t,e){var o=this.commentLimit?"/"+this.commentLimit:"";a.buildAjaxUpdaterRequest({file:"comments",args:t.contextType+"/"+t.contextID+o,page:t.page||1},function(){window.cmPictureFill(),n.trigger("slidebars-refresh"),c.init("#comments"),e&&e()})},c.save=function(t,n,o){var i=n.id?"mod":"add",a="add"===i?"/ajax/add/comment/"+String(t.contextType)+"/"+String(t.contextID):"/ajax/mod/comment/"+String(t.contextType)+"/"+String(n.id);return n.comments=e.trim(n.comments.stripLowerASCII()),n.comments.length?(1!==t.mute&&0!==t.mute||(n.mute=t.mute),n.contextType=t.contextType,n.contextID=t.contextID,void e.ajax({url:a,type:"POST",data:n,dataType:"json",success:function(t){var e="success"!==t.status?e.message:null;o&&o(e,t)}})):o&&o("Please type a comment.")},c.updateCounts=function(t,n){e(".comment-count-num").html(n);var o=e(".comment-count-s");0!==o.length&&(1===parseInt(t,10)?o.hide():o.show())},c.init=function(t){if(t=e(t),0!==t.length){t.data("limit")&&(this.commentLimit=t.data("limit"));for(var d,u=[],l=e(".comment",t),m=0;m<l.length;m++)d=e(l[m]),u.push({id:d.data("user-id"),name:d.data("user-name"),username:d.data("user-username"),avatar:d.data("user-avatar"),type:"user"});r.add(u);var p=function(t){t.data("setup")||(t.data("setup",!0),t.autoResize(120,1e3,16),r.init(t))};p(e(".form-comment textarea",t)),i.init(),t.data("setup")||(t.data("setup",!0),o.init(),t.on("click",".comment-edit",function(t){t.preventDefault();var n=e(this),o=n.parents(".comment:first"),i=o.parents("ol:first"),a=e("form",o),s=e("textarea",a),r=i.data("context-type"),c=o.data("comment-id"),d=s.val(),u=e("#comment-actions-"+r+c),l=e("#cm-"+r+c),m=e("a.cancel",a);s.css("height",l.height()),a.show(),u.hide(),l.hide(),p(s),s.focus(),m.off("click"),m.on("click",function(t){return a.hide(),u.show(),l.show(),s.mentionsInput("reset",d),!1})}),t.on("click",".comment-approve",function(t){if(confirm("Are you sure you want to approve this comment?")){var n=e(this),o=n.parents("ol:first"),i=o.data("context-type"),a=o.data("comment-id");e.ajax("/ajax/mod/comment/"+i+"/"+a+"/status/approve",{type:"post"}),n.parents("li").removeClass("light-bg"),n.prev().remove(),n.remove()}return!1}),t.on("click",".comment-delete",function(t){t.preventDefault();var n=e(this).parents(".comment:first"),o=n.parents("ol:first"),i=o.data("context-type"),s=o.data("context-id"),r=n.data("comment-id"),c=o.data("page"),d="Are you ABSOLUTELY sure you want to delete this comment?\n\nThis cannot be undone!",u="/op/rm/comment/"+i+"/"+s+"/"+r+"/_page_"+c;a.confirmRedirect(d,u)}),t.on("click",".comment-bury",function(t){t.preventDefault();var n=e(this).parents(".comment:first"),o=n.closest("li"),i=n.parents("ol:first"),a=i.data("context-type"),s=i.data("context-id"),r=n.data("comment-id"),c={},d="/ajax/mod/comment/"+String(a)+"/"+String(r);c.contextType=a,c.contextID=s,c.bury=!0,window.confirm("Are you ABSOLUTELY sure you want to bury this comment?")&&(o.fadeOut(),e.ajax({url:d,type:"POST",data:c,dataType:"json",success:function(t){"success"!==t.status&&(alert("There was a problem burying this comment."),o.fadeIn())}}))}),t.on("submit","form",function(t){var n,o=e("input[name=id]",this).val(),i=e("input[name=context_type]",this).val(),a=e("input[name=context_id]",this).val(),r=e("textarea[name=comments]",this),d=e("button[type=submit]",this),u=e(".button-text",d),l={},m={contextType:i,contextID:a};e("input[name=mute]").length>0&&(m.mute=e("input[name=mute]",this).is(":checked")?0:1);var p=function(){r.prop("readonly",!0),d.addClass("disabled"),d.hasClass("btn-small")||(d.css({width:d.outerWidth()}),u.hide(),n=new s(d,{size:"small",color:"white"}),n.show()),c.save(m,l,function(t,e){return t?(alert(t),n&&(n.remove(),u.show()),r.prop("readonly",!1),void d.removeClass("disabled")):(c.updateCounts(e.count,e.count_formatted),c.refresh({id:e.id,page:e.page,contextType:i,contextID:a}),void analytics.track("Commented"))})};return t.preventDefault(),!d.hasClass("disabled")&&(l.id=o,void r.mentionsInput("val",function(t){l.comments=t,p()}))}),t.on("click",".paging a",function(n){var o=e(this),i=e(".paging a",t),a=e("#comment-list"),s=o.attr("href"),r=s.match(/[?&]page=(\d+)/)[1],d=a.data("context-id"),u=a.data("context-type");return!i.hasClass("disabled")&&(i.addClass("disabled"),c.refresh({page:r,contextType:u,contextID:d},function(){if(window.history.replaceState){var t=!1,n=window.location.href,o=n.indexOf("#");o!==-1&&(n=n.substring(0,o)),n=n.replace(/([?&])page=\d+/,function(){return t=!0,arguments[1]+"page="+r}),t||(n+=(n.indexOf("?")!==-1?"&":"?")+"page="+r),n+="#comments",window.history.replaceState(null,document.title,n)}e("html, body").animate({scrollTop:e("#comments").offset().top},100)}),!1)}),n.on("session:create",function(){var t=e("#comments"),n=t.data("context-id"),o=t.data("context-type");n&&o&&c.refresh({contextID:n,contextType:o})}))}},c}),define("blog",["require","jquery","underscore","shared/util","shared/regex","comments","vendor/jquery/tipsy","shared/views/facebook_connect_button","shared/models/session","event_bus"],function(t){var e=t("jquery"),n=t("underscore"),o=t("shared/util"),i=t("shared/regex"),a=t("comments"),s=(t("vendor/jquery/tipsy"),t("shared/views/facebook_connect_button")),r=t("shared/models/session"),c=t("event_bus"),d={ui:{signupBanner:e("header.signup-banner"),stickyHeader:e("header.sticky"),dropdownTrigger:e(".hero nav .dropdown-trigger"),nav:e(".hero nav ul"),formats:e("ul.formats a"),forms:e("form"),search:e("form.search"),digest:e("form.digest"),tweetable:e('.post .content [data-share="twitter"]'),top:e("a.top"),fbLikeCTA:e(".facebook-like-cta"),conversionBoxes:e(".conversion-box")},init:function(){var t=this;n.bindAll(this),a.init("#comments"),this.ui.dropdownTrigger.on("click",this.onDropdownClick),this.ui.formats.on("click",this.onClickFormat),this.ui.formats.tipsy(),this.ui.forms.find("input").on("input focus blur",this.onFormInput),this.ui.search.on("reset",this.onSearchReset),this.ui.search.on("submit",this.onSearchSubmit),this.ui.digest.on("submit",this.onDigestSubmit),this.ui.top.on("click",this.onClickTop),this.ui.fbLikeCTA.find(".iframe-overlay").on("click",this.onFbLikeClick),this.ui.conversionBoxes.find(".btn").on("click",this.onConversionBoxClick),e(window).on("scroll",n.throttle(this.onWindowScroll,100)).trigger("scroll"),this.ui.signupBanner.length&&n.delay(function(){e("#wrap").css({paddingTop:"+="+t.ui.signupBanner.height()})},600);var o=new s({model:r,label:"Continue &rarr;",className:"btn btn-facebook facebook-login"});this.ui.signupBanner.find(".facebook-login").replaceWith(o.render().el),e("html").addClass("rendered"),this.setupInlineTweets(),c.on("session:create",this.onSessionCreate,this)},onDropdownClick:function(t){t.preventDefault(),this.ui.dropdownTrigger.toggleClass("active"),this.ui.nav.toggleClass("open")},onClickFormat:function(t){var n=e(t.currentTarget),i=window.location.pathname,a=o.getQueryParams();a.format=n.data("format"),t.preventDefault(),window.location.href=i+"?"+e.param(a)},onFormInput:function(t){var n=e(t.currentTarget),o=n.closest("form");o.toggleClass("has-input",!!n.val().trim())},onSearchReset:function(t){this.ui.search.find(":input").attr("value","").val(""),e(t.currentTarget).find(":input:first").trigger("focus")},onSearchSubmit:function(t){var n=e(t.currentTarget),i=n.find('[name="bq"]').val().trim(),a=o.getQueryParams();i||n.addClass("shake").one("webkitAnimationEnd oanimationend msAnimationEnd animationend",function(){n.removeClass("shake")}),window.analytics.track("Searched",{Type:"Blog",Query:i,Module:n.closest("[data-module]").data("module")},function(){a.bq=i,window.location.href="/blog?"+e.param(a)}),t.preventDefault()},onDigestSubmit:function(t){var n=e(t.currentTarget),o=n.find('[name="token"]'),a=n.find('[name="email"]'),s=a.length?a.val().trim():"";return t.preventDefault(),window.analytics.track("Clicked",{Module:n.closest("[data-module]").data("module"),Text:n.find("[type=submit]").text()}),!a.length||s&&i.EMAIL_ADDRESS.test(s)?void e.ajax("/ajax/add/blog-subscription",{type:"post",data:{token:o.val(),emailAddress:a.val()}}).done(function(){n.find(".flippable").addClass("flip"),r.isLoggedIn()||n.find(".sign-up .btn").on("click",function(t){t.preventDefault(),r.authenticate("sign-up",{email:s}).then(function(){window.location.reload()})})}).fail(function(){}):(n.find(".controls").addClass("shake").one("webkitAnimationEnd oanimationend msAnimationEnd animationend",function(){n.find(".controls").removeClass("shake")}),void n.find(":input:first").trigger("focus"))},onConversionBoxClick:function(t){function n(){var n=e(t.currentTarget).closest(".conversion-box");window.setTimeout(function(){window.analytics.track("Downloaded",{Type:n.data("name")}),window.location.href=n.data("asset-url")},1e3)}t.preventDefault(),r.isLoggedIn()?n():r.authenticate("sign-up",!1,"Conversion Box").then(function(t){/signup/.test(t.sessionMethod)&&e.post("/ajax/add/blog-subscription"),n()})},onClickTop:function(t){t.preventDefault(),e("html, body").animate({scrollTop:0})},onFbLikeClick:function(t){t.preventDefault();var n=e(t.currentTarget);n.find("iframe").css("pointer-events","all"),window.analytics.track("Clicked",{Text:"Like",Module:"Blog Sidebar",Action:"Facebook Like"})},onWindowScroll:function(){var t=e(window),n=t.scrollTop(),o=n+t.height(),i=e("main").offset().top;this.ui.stickyHeader.toggleClass("stuck",n>=i),e("article.post.display-full .content .pull").each(function(){var t=e(this),n=t.offset().top,i=n+.75*t.height();i<=o&&t.addClass("onscreen")})},onSessionCreate:function(){if(this.ui.signupBanner.length){var t=400;e("#wrap").animate({paddingTop:"-="+this.ui.signupBanner.height()},t),this.ui.signupBanner.slideUp(t)}},setupInlineTweets:function(){this.ui.tweetable.each(function(){var t=e(this);t.wrapInner('<span class="text"></span>'),t.append('<i class="icon-twitter small"></i>'),t.attr("data-description",t.text())})}};e(function(){d.init()})});