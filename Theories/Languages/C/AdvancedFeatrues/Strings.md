# Strings


<!-- TOC -->

- [Strings](#strings)
    - [字符串字面量](#字符串字面量)
        - [字符串字面量中的转义序列](#字符串字面量中的转义序列)
        - [延续字符串字面量](#延续字符串字面量)
        - [如何存储字符串字面量](#如何存储字符串字面量)
        - [字符串字面量的操作](#字符串字面量的操作)
        - [字符串字面量与字符常量](#字符串字面量与字符常量)
    - [References](#references)

<!-- /TOC -->


## 字符串字面量
**字符串字面量**（string literal）是用一对双引号括起来的字符序列。

### 字符串字面量中的转义序列
TODO，八进制数和十六进制数的转义序列

### 延续字符串字面量
1. 如果发现字符串字面量太长而无法放置在单独一行以内，只要把第一行用字符 `\` 结尾，那么 C 语言就允许在下一行延续字符串字面量。
    ```cpp
    printf("When you come to a fork in the road, take it.   \
    --Yogi Berra");
    ```
2. 除了（看不到的）末尾的换行符，在同一行不可以有其他字符跟在 `\` 后面。
3. 使用 `\` 有一个缺陷：字符串字面量必须从下一行的起始位置继续。因此，这就破坏了程序的缩进结构
    ```cpp
    int main(void)
    {
        printf("abcd\
        efg");           // abcd    efg

        printf("abcd\
    efg");               // abcdefg
        return 0;
    }
    ```
4. 处理长字符串字面量有一种更好的方法：当两条或更多条字符串字面量相邻时（仅用空白字符分割），编译器会把它们合并成一条字符串。这条规则允许把字符串分割放在两行或者更多行中
    ```cpp
    int main(void)
    {
        printf("abcd"
                "efg"); // abcdefg
        return 0;
    }
    ```

### 如何存储字符串字面量
1. 从本质而言，C 语言把字符串字面量作为字符数组来处理。
2. 当 C 语言编译器在程序中遇到长度为 $n$ 的字符串字面量时，它会为字符串字面量分配长度为 $n+1$ 的内存空间。这块内存空间将用来存储字符串字面量中的字符，以及一个用来标志字符串末尾的额外字符（空字符）。
3. 空字符是一个所有位都为 `0` 的字节，因此用转义序列 `\0` 来表示。
4. 例如，字符串字面量 `"abc"` 是作为有 4 个字符的数组来存储的（`a`、`b`、`c` 和 `\0`）：
    <img src="./images/04.png" width="200" style="display: block; margin: 5px 0 10px;" />
5. 字符串字面量可以为空。字符串 `""` 作为单独一个空字符来存储：
    <img src="./images/05.png" width="50" style="display: block; margin: 5px 0 10px;" />
6. 既然字符串字面量是作为数组来存储的，那么编译器会把它看作是 `char *` 类型的指针。例如，`printf` 函数和 `scanf` 函数都接收 `char *` 类型的值作为它们的第一个参数。思考下面的例子：
    ```cpp
    printf("abc");
    ```
    当调用 `printf` 函数时，会传递 `"abc"` 的地址，即指向存储字母 `a` 的内存单元的指针。

### 字符串字面量的操作
1. 通常情况下可以在任何 C 语言允许使用 `char *` 指针的地方使用字符串字面量。例如，字符串字面量可以出现在赋值运算符的右边：
    ```cpp
    char *p;

    p = "abc";
    ```
    这个赋值操作不是复制 `"abc"` 中的字符，而是使p指向字符串的第一个字符。
2. C 语言允许对指针取下标，因此可以对字符串字面量取下标：
    ```cpp
    char ch;

    ch = "abc"[1];
    ```
    `ch` 的新值将是字母 `b`。
3. 因为保存字符串的数组是字符长度加一，所以下标还可以取到最后的空字符
    ```cpp
    char ch = "abc"[3];
    printf("[%c]", ch); // [ ]
    ```
4. 字符串字面量的这种特性并不常用，但有时也比较方便。思考下面的函数，这个函数把 0~15 的数转换成等价的十六进制的字符形式：
    ```cpp
    char digit_to_hex_char(int digit)
    {
        return "0123456789ABCDEF"[digit];
    }
    ```
5. 试图改变字符串字面量会导致未定义的行为：
    ```cpp
    char *p = "abc";

    *p = 'd';   /*** WRONG ***/
    ```

### 字符串字面量与字符常量
1. 只包含一个字符的字符串字面量不同于字符常量。字符串字面量 `"a"` 是用 **指针** 来表示的，这个指针指向存放字符 `"a"`（后面紧跟空字符）的内存单元。字符常量 `'a'` 是用 **整数**（字符集的数值码）来表示的。
2. 不要在需要字符串的时候使用字符（反之亦然）。函数调用
    ```cpp
    printf("\n");
    ```
    是合法的，因为 `printf` 函数期望指针作为它的第一个参数。然而，下面的调用却是非法的：
    ```cpp
    printf('\n');    /*** WRONG ***/
    ```
    同样这样也是错误的
    ```cpp
    char ch = "a"; // warning: initialization makes integer from pointer without a cast
    ```






























































































## References
* [C语言程序设计](https://book.douban.com/subject/4279678/)