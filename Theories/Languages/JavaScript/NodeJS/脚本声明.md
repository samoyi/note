# Shebang `#!/usr/bin/env node` 详解

## 一、基本含义
Unix/Linux 系统下的脚本声明，用于指定脚本文件的解释器。完整格式解析：

| 组成部分           | 作用说明                                                                 |
|--------------------|--------------------------------------------------------------------------|
| `#!`               | Shebang 符号，声明这是一个需要解释器执行的脚本                           |
| `/usr/bin/env`     | 环境变量查找工具，用于在系统的 PATH 环境变量中查找命令                   |
| `node`             | 指定使用 Node.js 运行时来执行这个脚本                                    |

## 二、核心作用

### 1. 直接执行脚本
```bash
# 添加执行权限后
chmod +x script.js

# 直接运行（不需要显式调用 node）
./script.js
```

### 2. 跨平台兼容
```text
# 不同系统的 Node 安装路径示例
macOS: /usr/local/bin/node
Linux: /usr/bin/node
Windows: C:\Program Files\nodejs\node.exe
```

```bash
# 直接指定路径的方式（不推荐）
#!/usr/local/bin/node ❌ 兼容性差

# 动态查找方式（推荐）
#!/usr/bin/env node ✅ 自动适配所有系统
```

## 三、对比其他写法

| 写法                      | 优点                  | 缺点                      |
|--------------------------|----------------------|--------------------------|
| `#!/usr/bin/env node`     | 跨平台兼容            | 需要脚本有执行权限        |
| `#!/usr/local/bin/node`   | 明确指定路径          | 路径不同时导致执行失败    |
| 无 Shebang + `node script.js` | 兼容所有系统          | 必须手动调用 node         |

## 四、使用规范

### 1. 文件权限要求
```bash
# 必须添加可执行权限
chmod +x script.js
```

### 2. 文件扩展名处理
```bash
# 直接运行 TypeScript 的写法（需安装 ts-node）
#!/usr/bin/env ts-node

# 生产环境建议编译为 JS
#!/usr/bin/env node
dist/
  └── script.js # 编译后的文件
```

## 五、典型应用场景

### 1. 命令行工具开发
```javascript
// cli.js
#!/usr/bin/env node
console.log('Hello from CLI!');
```

### 2. 可执行脚本打包
```json
// package.json
{
  "bin": {
    "my-tool": "./dist/cli.js"
  }
}
```

## 六、注意事项

1. ​**必须作为文件首行**  
   前面不能有任何空行或注释

2. ​**行尾避免空格**  
   错误的写法：`#!/usr/bin/env node `（结尾有空格）

3. ​**编码格式**  
   保存为 UTF-8 格式避免乱码

---

通过这种声明方式，可以让你开发的 Node.js 工具获得类似系统命令的使用体验，同时保持跨平台兼容性。这是开发 npm 全局包和 CLI 工具时的标准实践方案。