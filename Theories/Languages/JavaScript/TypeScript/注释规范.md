# TypeScript 注释规范指南

## 目录
1. [文档注释 (TSDoc)](#1-文档注释-tsdoc)
2. [模块注释](#2-模块注释)
3. [类型注释](#3-类型注释)
4. [函数注释](#4-函数注释)
5. [最佳实践](#5-最佳实践)
6. [工具集成](#6-工具集成)
7. [完整示例](#7-完整示例)
8. [注意事项](#8-注意事项)

---

## 1. 文档注释 (TSDoc)

### 类/接口注释
```typescript
/**
 * 用户管理系统核心服务
 * 
 * @remarks
 * 实现以下核心功能：
 * - 用户注册/登录
 * - 权限管理
 * - 资料更新
 * 
 * @example
 * ```ts
 * const userService = new UserService();
 * await userService.register({ username: 'test', password: '123' });
 * ```
 */
class UserService {
  // ...
}
```

### 方法注释
```typescript
/**
 * 获取用户详细信息
 * @param userId - 用户ID (UUID格式)
 * @param options - 查询选项
 * @returns 用户信息对象
 * 
 * @throws {NotFoundError} 当用户不存在时
 */
async getUser(userId: string, options?: QueryOptions): Promise<User> {
  // ...
}
```

---

## 2. 模块注释

### 文件头部注释
```typescript
/*!
 * ===============================
 * 数据访问层 - 用户模块
 * 版本: 2.1.0
 * 最后更新: 2023-08-20
 * 依赖项:
 * - @prisma/client
 * - redis-client
 * ===============================
 */
```

### 代码块注释
```typescript
// #region 缓存管理
/*
 * 缓存策略说明：
 * 1. 使用LRU内存缓存
 * 2. Redis作为二级缓存
 * 3. 自动刷新机制
 */
const cacheManager = new CacheManager();
// #endregion
```

---

## 3. 类型注释

### 复杂类型
```typescript
type ApiResponse<T> = {
  /** HTTP状态码 */
  status: number;
  
  /** 响应数据 */
  data: T;
  
  /** 时间戳 (ISO格式) */
  timestamp: string;
}

interface Pagination<T> {
  /** 当前页数据 */
  items: T[];
  
  /** 总记录数 */
  total: number;
  
  /** 每页数量 */
  pageSize: number;
}
```

### 枚举注释
```typescript
enum UserRole {
  /** 系统管理员 - 完全控制权限 */
  Admin = 'ADMIN',
  
  /** 普通用户 - 基础权限 */
  User = 'USER',
  
  /** 访客 - 只读权限 */
  Guest = 'GUEST'
}
```

---

## 4. 函数注释

### 通用函数
```typescript
/**
 * 深度合并多个对象
 * @param objects - 要合并的对象列表
 * @returns 深度合并后的新对象
 * 
 * @example
 * const merged = deepMerge({a: 1}, {b: 2});
 */
function deepMerge<T extends object>(...objects: T[]): T {
  // ...
}
```

### 高阶函数
```typescript
/**
 * 创建带重试机制的请求函数
 * @param fn - 基础请求函数
 * @param options - 重试配置
 * @returns 带重试功能的新函数
 */
function withRetry<F extends (...args: any[]) => Promise<any>>(
  fn: F,
  options: RetryOptions
): F {
  // ...
}
```

---

## 5. 最佳实践

### 维护性注释
```typescript
// TODO: 需要实现分布式锁机制 (#JIRA-123)
// FIXME: 内存泄漏问题 (最后检测于v2.0.3)

/**
 * @deprecated 请使用新版加密模块
 * @removeIn version 3.0
 */
function oldEncrypt() {}
```

### 可视化注释
```typescript
// 认证流程:
// 1. 验证请求头 → 2. 检查权限 → 3. 记录审计日志
//     ↑               ↓
//     └─失败响应←─权限不足
```

---

## 6. 工具集成

### TypeDoc 配置示例
```json
{
  "out": "docs/",
  "excludeExternals": true,
  "excludePrivate": true,
  "hideGenerator": true
}
```

### ESLint 规则
```json
{
  "rules": {
    "tsdoc/syntax": "warn",
    "require-jsdoc": ["error", {
      "require": {
        "FunctionDeclaration": true,
        "MethodDefinition": true
      }
    }]
  }
}
```

---

## 7. 完整示例

```typescript
/**
 * 订单处理服务
 * 
 * @packageDocumentation
 * @module OrderService
 */

import { PaymentGateway } from './payment';

/** 订单状态流程 */
export enum OrderStatus {
  /** 新创建订单 */
  Created = 'CREATED',
  
  /** 支付完成 */
  Paid = 'PAID',
  
  /** 订单已发货 */
  Shipped = 'SHIPPED'
}

/**
 * 订单服务类
 * @remarks
 * 处理订单生命周期管理，包括：
 * - 订单创建
 * - 支付处理
 * - 物流跟踪
 */
export class OrderService {
  private paymentGateway: PaymentGateway;

  /**
   * 创建订单服务实例
   * @param paymentConfig - 支付配置
   */
  constructor(paymentConfig: PaymentConfig) {
    this.paymentGateway = new PaymentGateway(paymentConfig);
  }

  /**
   * 创建新订单
   * @param orderData - 订单数据
   * @returns 创建成功的订单对象
   * 
   * @throws {ValidationError} 数据验证失败时抛出
   */
  async createOrder(orderData: CreateOrderDto): Promise<Order> {
    // ...
  }
}
```

---

## 8. 注意事项

1. **类型自解释性**  
   优先使用清晰的类型定义替代冗余注释：
   ```typescript
   // 不推荐
   type User = any; // 用户对象
   
   // 推荐
   type User = {
     id: string;
     name: string;
     email: string;
   }
   ```

2. **注释更新**  
   修改代码时必须同步更新相关注释

3. **国际化建议**  
   公共API注释建议使用英文：
   ```typescript
   /**
    * Get user by ID
    * @param userId - Target user ID
    */
   ```

4. **敏感操作警告**  
   ```typescript
   // !!! DANGER: 此操作不可逆，会删除所有数据 !!!
   async dropDatabase() {}
   ```

> 文档生成建议：使用 [TypeDoc](https://typedoc.org/) + [Vitepress](https://vitepress.dev/) 生成可维护的API文档