# 语言处理器


<!-- TOC -->

- [语言处理器](#语言处理器)
    - [设计目的](#设计目的)
        - [关键细节](#关键细节)
    - [实现原理](#实现原理)
    - [抽象本质](#抽象本质)
    - [设计思想](#设计思想)
    - [编译器（compiler）和解释器（interpreter）](#编译器compiler和解释器interpreter)
        - [混合编译器（Hybrid compiler）](#混合编译器hybrid-compiler)
    - [其他需要的处理程序](#其他需要的处理程序)
    - [References](#references)

<!-- /TOC -->


## 设计目的
把程序员编写的源代码转变成机器可执行的机器代码。

### 关键细节
* 兼容问题：编译出的源代码只能自同类型机器上运行。
* 复杂度问题：从源代码到最终代码的转换过程很复杂。
* 执行开始时间和执行效率的权衡问题：有些应用（例如 web）就不适合完整编译后再执行。


## 实现原理
* 解决兼容问题：字节码。
* 解决复杂度问题：一系列程序分别独立的处理从源程序到目标程序的各个步骤。
* 执行开始时间和执行效率的权衡问题：字节码 + JIT。


## 抽象本质
* 翻译的速度和质量，就像同声传译和精准翻译。


## 设计思想
* 低耦合：字节码
* SRP：功能分层
* 权衡：执行开始时间和执行效率的权衡


## 编译器（compiler）和解释器（interpreter）
1. 简单的说，**编译器** 是一个程序，它可以读取以一种语言（源语言）编写的程序，把它翻译成以另一种语言（目标语言）呈现的等价程序。
    <img src="./images/01.png" width="200" style="display: block; margin: 5px 0 10px;" />
2. 编译器的重要任务之一是在翻译过程中发现并报告源程序中的错误。
3. 如果目标程序是可执行的机器语言程序，那么它可以被用户调用，来处理输入数据并产生输出
    <img src="./images/02.png" width="400" style="display: block; margin: 5px 0 10px;" />
4. **解释器** 是另一种常见的语言处理器，它并不是通过翻译产生目标程序，解释器看起来是直接使用用户提供的数据来执行源程序
    <img src="./images/03.png" width="400" style="display: block; margin: 5px 0 10px;" />
5. 对于把输入转换为输出的过程，编译器产生的机器语言目标程序要比解释器快得多；但是解释器可以更好的诊断错误，因为它逐个语句的执行源程序。
7. 程序的执行就是接收输入并产出输出。编译器是先处理好源程序再执行程序，解释器是一边处理源程序一边执行。

### 混合编译器（Hybrid compiler）
1. 例如，Java 语言处理器就是混合了编译和解释的过程
    <img src="./images/04.png" width="400" style="display: block; margin: 5px 0 10px;" />
2. Java 程序会先经过编译，但并不是直接编译成机器码，而是被称为 **字节码**（btyecodes）的中间形式；字节码然后再被虚拟机解释执行。
3. 这样的好处是，在一个机器上编译生成的字节码也可以在其他机器上解释执行。
4. 为了弥补解释执行低效的问题，有时还会采用 **即时（Just-In-Time, JIT）编译** 策略，也就是在一段中间程序即将被执行前，即时的将它编译成机器语言，然后再执行。


## 其他需要的处理程序
1. 除了编译器外，把源程序转变为可执行的目标程序还需要其他一些程序的工作。包括 **预处理器**（preprocessor）、 **汇编器**（assembler）、**链接器**（linker）和 **加载器**（loader）
    <img src="./images/05.png" width="400" style="display: block; margin: 5px 0 10px;" />
2. 源程序可能分割为多个模块并保存在独立的文件里，收集源程序不同部分的工作有时会交给一个独立的程序来完成，被称为预处理器。预处理器还会把称为 **宏**（macro）的缩写转变为源语言的语句。
3. 预处理之后的源程序输入给编译器，编译器可能会输出为汇编语言程序。因为汇编语言更容易输出和调试。
4. 汇编语言接下来被汇编器处理，生成可重定位的机器代码。
5. 大型程序通常分块编译，因此可重定位机器代码要和其他可重定位对象文件以及库文件连接到一起才能真正运行。链接器可以解决外部内存地址的问题，因此可以让一个文件里的代码引用到另一个文件里的代码。
6. 最后，加载器把所有的可执行目标文件加载到内存中执行。


## References
* [*Compilers*](https://book.douban.com/subject/1866231/)