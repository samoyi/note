# 响应式总结


<!-- TOC -->

- [响应式总结](#响应式总结)
    - [Observe 阶段：实现响应式、创建发布者](#observe-阶段实现响应式创建发布者)
    - [模板编译阶段：编译模板、绑定事件、创建订阅者](#模板编译阶段编译模板绑定事件创建订阅者)
        - [把模板中的指令转化为实际的 HTML](#把模板中的指令转化为实际的-html)
        - [绑定事件](#绑定事件)
        - [创建订阅者](#创建订阅者)
    - [数据更新阶段](#数据更新阶段)
    - [具体是怎么转换为访问器属性的？](#具体是怎么转换为访问器属性的)
    - [数据更新后具体怎么更新节点的？](#数据更新后具体怎么更新节点的)

<!-- /TOC -->


<img src="../../images/ReactivitySystem.png" width="600" style="display: block; margin: 5px 0 10px;" />


## Observe 阶段：实现响应式、创建发布者
1. `Observer` 模块会遍历 `data`，为每一条数据创建一个 `Dep` 实例 `dep`，该实例代表着 view 层中一个或多个节点（以 `Watcher` 实例的形式）所依赖的数据。
2. `dep` 是 发布-订阅 模式中的发布者。`dep` 会有一个订阅者列表属性，用来保存依赖自己的订阅者（`Watcher` 实例）；还有一个添加订阅者的方法，以及在数据更新后通知订阅者更新的方法。
3. `Observer` 同时会把该数据转换为访问器属性，其中的 `setter` 函数中会调用该数据的 `dep` 的通知订阅者更新的方法。


## 模板编译阶段：编译模板、绑定事件、创建订阅者
### 把模板中的指令转化为实际的 HTML
1. `Compiler` 模块编译模板，扫描模板中的指令，根据不同的指令类型替换为对应的 HTML。

* 文本节点变量替换为具体的值，具体怎么实现？
* `v-if` 具体实现？
* `v-for` 具体实现？
* `v-model` 具体实现？

### 绑定事件
当扫描到某个节点比如 `'v-on'` 指令时，会为该节点绑定指令中的事件类型和处理函数。

### 创建订阅者
1. 当扫描到某个节点有依赖数据的指令时，会为给节点创建一个 `Watcher` 实例 `watcher`，作为订阅者。
2. 该 `watcher` 会记录指令的类型，也就是要如何更新该节点。
3. 然后通过指令中依赖的数据，找到数据对应的 `dep`，把 `watcher` 注册到该 `dep` 上。


## 数据更新阶段




## 具体是怎么转换为访问器属性的？
1. 实际操作由 `Observer` 模块负责。
2. 编译模板阶段，扫描模板中的指令，获得节点及其依赖的数据之间的对应关系。
2. 通过 getter，记录到 watcher。


## 数据更新后具体怎么更新节点的？
watcher