# 一个完整的配置流程实例


## 项目内容
* webpack 4
* vue
* babel 7


## 环境
* webpack：
* Node：8.11.4
* npm：5.6.0
* os：windows 64-bit


## 搭建 Node 环境


## 安装模块
## 安装 webpack 相关模块
1. 本地安装 webpack
2. 因为使用 webpack v4+ 版本，所以还需要安装 CLI
3. 开发服务器模块：`webpack-dev-server`
4. 自动生成 HTML 的模块：`html-webpack-plugin`
5. 融合配置文件的模块：`webpack-merge`

```shell
npm install --save-dev webpack webpack-cli webpack-dev-server html-webpack-plugin webpack-merge
```

### 安装 vue 相关模块
1. 基本的三个部分：vue、vue-route和vuex
    ```shell
    npm install vue vue-router vuex
    ```
2. 因为要使用 vue 单文件组件(`.vue`)，webpack 需要使用`vue-loader`解析加载该类文件，
同时还要求安装`vue-template-compiler`模块。
3. `.vue`组件中会用到 scss 语法，所以还需要`sass-loader`编译为 css 文件。同时，因为实
际的编译是通过`node-sass`模块执行的，所以也要安装该模块。 

```shell
npm install --save-dev vue-loader vue-template-compiler sass-loader node-sass
```

### 安装 babel 相关模块
1. 安装 7.x 版本的 babel-core：`@babel/core`
2. 除了 babel 的转码核心外，还要安装转码插件集（preset）组成的。7.x 的模块为名：
`@babel/preset-env`
3. webpack 需要通过`babel-loader`来使用 babel 转码 JS 代码
4. 还要安装 polyfill 来转码语法以外的 JS 新特性，7.x 的模块名为：`@babel/polyfill`
5. 因为可能还会用到`import()`函数，该函数目前还是实验性质，还需要单独的插件来支持：
`@babel/plugin-syntax-dynamic-import`
```shell
npm install --save-dev @babel/core @babel/preset-env babel-loader @babel/polyfill @babel/plugin-syntax-dynamic-import
```

### 安装其他 loader
1. 为了加载 css 文件，需要`css-loader`；为了创建行内`<style>`，需要`style-loader`。
2. 为了加载图片字体等文件，需要`file-loader`；如果希望把小的文件直接转换为 DataURL，再
安装`url-loader`。
3. webpack4 中，开发模式会自动压缩代码，所以不需要安装和配置`UglifyJsPlugin`

```shell
npm install --save-dev css-loader style-loader file-loader url-loader
```


## 创建基本的目录和文件
创建源代码目录`/src`、分发代码目录`/dist`和配置文件目录`/webpackConfigs`。


## 编写配置文件
分为通用配置、开发配置和生产配置三个文件。

### 通用配置文件
1. 路径为`/webpackConfigs/common.js`
2. 内容为
    ```js
    const path = require('path');
    const HtmlWebpackPlugin = require('html-webpack-plugin');
    // const VueLoaderPlugin = require('vue-loader/lib/plugin');

    module.exports = {
        entry: './src/index.js',
        output: {
            // 打包输出的目录
            path: path.resolve(__dirname, 'dist'),
            // 打包的文件名在开发环境和生产环境不同，生产环境会带上 hash
        },
        resolve: {
            // 在默认的四个之上在加上`.vue`后缀，这样 import `.vue` 文件时不需要写后缀
            extensions: ['.wasm', '.mjs', '.js', '.json', '.vue'],
            // 默认加载的 vue 模块是仅运行时的，不带模板编译功能。这里参考 vue-cli 的配置，
            // 使用完整版，使其可以编译模板
            alias: {
                'vue$': 'vue/dist/vue.esm.js'
            },
        },
        module: {
            rules: [
                {
                    test: /\.css$/,
                    use: [
                        // 'vue-style-loader',
                        'style-loader',
                        'css-loader'
                    ],
                },
                {
                    test: /\.scss$/,
                    use: [
                        // 'vue-style-loader',
                        'style-loader',
                        'css-loader',
                        'sass-loader', // 把 scss 编译为 css
                    ],
                },
                // {
                //     test: /\.sass$/,
                //     use: [
                //         'vue-style-loader',
                //         'css-loader',
                //         'sass-loader?indentedSyntax'
                //     ],
                // },
                {
                    test: /\.js$/,
                    exclude: /node_modules/, // 不编译 node_modules 里的 js 文件
                    loader: 'babel-loader',
                },
                {
                    test: /\.vue$/,
                    loader: 'vue-loader',
                    options: {
                        loaders: {
                            // Since sass-loader (weirdly) has SCSS as its default parse mode, we map
                            // the "scss" and "sass" values for the lang attribute to the right configs here.
                            // other preprocessors should work out of the box, no loader config like this necessary.
                            'scss': [
                                'vue-style-loader',
                                'css-loader',
                                'sass-loader'
                            ],
                            'sass': [
                                'vue-style-loader',
                                'css-loader',
                                'sass-loader?indentedSyntax'
                            ]
                        }
                        // other vue-loader options go here
                    }
                },
                {
                    test: /\.(jpe?g|png|gif|webp|svg)$/,
                    loader: 'url-loader',
                    options: {
                        limit: 8192, // 大于8KiB的文件改为使用file-loader
                    },
                },
            ],
        },
        plugins: [
            new HtmlWebpackPlugin({
                // 自动生成 index.html 以该文件为模板，内部会包含一个 id 为 app 的 div
                template: '../src/index.html',
            }),
            // new VueLoaderPlugin(),
        ],
    };
    ```

### 开发配置文件
1. 路径为`/webpackConfigs/dev.js`
2. 内容为
    ```js
    const merge = require('webpack-merge');
    const common = require('./common.js');

    // 把通用的配置和当前的开发配置合并到一起
    module.exports = merge(common, {
        mode: 'development', // 默认值是`production`
        devtool: 'inline-source-map',
        output: {
            filename: '[name].bundle.js',
        },
        devServer: { // 开发服务器读取文件的目录
            contentBase: '/dist',
        },
    });
    ```

### 生产配置文件
1. 路径为`/webpackConfigs/prod.js`
2. 内容为


## `package.json` 中添加 script
"scripts": {
    "dev": "webpack-dev-server -hot --config webpackConfigs/dev.js",
    "build": "webpack --config webpackConfigs/prod.js"
}


## 编写入口文件
```js
import Vue from 'vue';

new Vue({
    el: '#app',
    template: `<div>
                    <h1>webpack4-demo</h1>
            </div>`,
});
```
