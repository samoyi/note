# Assertions


## 错误处理和断言的区别
1. 错误处理就如字面所说，是对可预期错误的处理，处理之后程序可能还是继续正常运行。错误处理通常用来检查不合理的输入。
2. 而断言也如字面所说，是要断定不会这样。如果程序员断言不会这样，但最后居然还这样了，那就证明程序员错了，也就是说程序有 bug 了。


## 不要把正常代码放进断言中
1. 断言主要用于开发和维护阶段，对于生产代码可以不把断言编译进去，以免降低性能。
2. 所以必须要保证在关闭断言之后程序还能正常执行。例如下面的断言写法就是错误的
    ```vb
    Debug.Assert( PerformAction() ) ' Couldn't perform action
    ```
3. 只要对 `PerformAction` 的返回值进行断言，所以直接把调用写进了断言里。但显然如果关闭断言，`PerformAction` 就没法执行了。所以应该这样写
    ```vb
    actionPerformed = PerformAction()
    Debug.Assert( actionPerformed ) ' Couldn't perform action
    ```


## 用断言来说明和验证前条件和后条件
1. **前条件**（precondition）和 **后条件**（postcondition）是 **契约式设计**（design by contract）的程序设计和开发方法的一部分。
2. 子程序的前条件规定了调用该子程序的前要满足的条件，而子程序的后条件则约束了子程序在调用完成后要确保为真的属性。
3. 前条件是调用方在调用子程序时需要承担的义务；后条件是子程序对调用方担负的责任。通过使用前条件和后条件，每个子程序与程序的其余部分形成了一份契约。
4. 例如对于强类型语言中的函数声明，指定的参数类型就是函数的前条件，而指定的函数返回值类型就是函数的后条件。而编译器确实也如同使用断言一样检查函数的参数类型和返回值类型。


## 对于高健壮性需求的代码，使用断言结合错误处理
对于复杂的程序，上线前难免有仅靠断言排查不到的错误。所以对于要求高健壮性的程序，还应该对断言的内容加上错误处理，上线时关闭断言后，如果还有意外的错误就由错误处理来处理。


## References
* [《代码大全（第2版）》](https://book.douban.com/subject/1477390/)