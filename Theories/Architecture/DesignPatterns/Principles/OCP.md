# Open–closed principle
software entities (classes, modules, functions, etc.) should be open for extension, but closed for modification


## 设计思想
1. 理解系统、维护系统和改变系统功能需要成本。
2. 系统内部的逻辑越复杂，则理解和维护起来越困难，改变的成本也越大。
3. 如果可以抽离出系统中不变的核心部分，则维护和改变只需要针对会变化的部分——分离变化和不变的部分
4. 而且系统的维护者和改变者也不需要去理解核心部分，降低了协作的成本。


## 应用
### 用对象的多态性消除条件分支
1. 过多的条件分支语句是造成程序违反开放-封闭原则的一个常见原因。每当需要增加一个新的`if`语句时，都要被迫改动原函数。把`if`换成`switch-case`是没有用的，这是一种换汤不换药的做法。
2. 实际上，每当我们看到一大片的`if`或者`swtich-case`语句时，第一时间就应该考虑，能否利用对象的多态性来重构它们。

### 放置挂钩
1. 我们在程序有可能发生变化的地方放置一个挂钩，挂钩的返回结果决定了程序的下一步走向。这样一来，原本的代码执行路径上就出现了一个分叉路口，程序未来的执行方向被预埋下多种可能性。
2. 由于子类的数量是无限制的，总会有一些“个性化”的子类迫使我们不得不去改变已经封装好的算法骨架。于是我们可以在父类中的某个容易变化的地方放置挂钩，挂钩的返回结果由具体子类决定。这样一来，程序就拥有了变化的可能。

### 使用回调函数
回调函数是一种特殊的挂钩。我们可以把一部分易于变化的逻辑封装在回调函数里，然后把回调函数当作参数传入一个稳定和封闭的函数中。当回调函数被执行的时候，程序就可以因为回调函数的内部逻辑不同，而产生不同的结果。


## 设计模式中的开放－封闭原则
### 发布-订阅模式
1. 发布-订阅模式用来降低多个对象之间的依赖关系，它可以取代对象之间硬编码的通知机制，一个对象不用再显式地调用另外一个对象的某个接口。
2. 当有新的订阅者出现时，发布者的代码不需要进行任何修改；同样当发布者需要改变时，也不会影响到之前的订阅者。

### 模板方法模式
1. 在一个运用了模板方法模式的程序中，子类的方法种类和执行顺序都是不变的，所以我们把这部分逻辑抽出来放到父类的模板方法里面；而子类的方法具体怎么实现则是可变的，于是把这部分变化的逻辑封装到子类中。
2. 通过增加新的子类，便能给系统增加新的功能，并不需要改动抽象父类以及其他的子类。

### 策略模式
1. 策略模式和模板方法模式是一对竞争者。在大多数情况下，它们可以相互替换使用。模板方法模式基于继承的思想，而策略模式则偏重于组合和委托。
2. 策略模式将各种算法都封装成单独的策略类，这些策略类可以被交换使用。策略和使用策略的客户代码可以分别独立进行修改而互不影响。我们增加一个新的策略类也非常方便，完全不用修改之前的代码。

### 代理模式
主体功能不用修改，使用代理来拓展功能。

### 职责链模式
链的执行环境保持封闭，链的组合保持开放。


## 开放－封闭原则的相对性
1. 让程序保持完全封闭是不容易做到的。就算技术上做得到，也需要花费太多的时间和精力。而且让程序符合开放-封闭原则的代价是引入更多的抽象层次，更多的抽象有可能会增大代码的复杂度。
2. 更何况，有一些代码是无论如何也不能完全封闭的，总会存在一些无法对其封闭的变化。
3. 另外，随着系统的演进，变化和不变也是会互相转化的。


## References
* [《JavaScript设计模式与开发实践》](https://book.douban.com/subject/26382780/)
